machine:
  services:
    - docker
  environment:
    ConnectionStrings__DefaultConnection: "Server=localhost;Database=HeadHuntReview;User Id=SA;Password=L@rc0mb3;MultipleActiveResultSets=true"

dependencies:
  override:
    - dotnet restore headhuntapi.csproj /p:StartupObject=headhuntapi.Program

database:
  override:
    - docker run -d -p 1433:1433 -e SA_PASSWORD=L@rc0mb3 -e ACCEPT_EULA=Y --name db microsoft/mssql-server-linux
    - docker inspect mssql

test:
  override:
    - dotnet test ./headhunttests/headhunttests.csproj

deployment:
  master:
    branch: master
    commands:
      - docker build -t headhuntapi .
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASSWORD
      - docker tag headhuntapi $DOCKER_USER/headhuntapi:latest
      - docker push $DOCKER_USER/headhuntapi